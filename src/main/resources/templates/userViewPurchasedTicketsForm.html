<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/css/boostrap.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/userCartForm.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css/fragments.css}" rel="stylesheet" type="text/css">
</head>
<body>
<header class="header" th:replace="flight-management/fragments :: header"></header>
<div class="container">
    <div th:each="ticketListEntry : ${ticketListMap}">
        <div th:with="flightId=${ticketListEntry.getKey()}">
            <div th:with="flight=${flightService.findFlightDTOById(flightId)}">
                <div class="container card-box">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="row">
                                <h5 class="my-option-name city">Departure City:</h5>
                                <h5 class="city" th:text="${flight.departureCity}"></h5>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="row">
                                <h5 class="my-option-name city">Arrival City:</h5>
                                <h5 class="city" th:text="${flight.arrivalCity}"></h5>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="row">
                                <h5 class="my-option-name time">Departure Time:</h5>
                                <h5 class="time"
                                    th:text="${#temporals.format(#temporals.createDateTime(flight.departureTime,'yyyy-MM-dd''T''HH:mm'),'dd-MM-yyyy HH:mm')}"></h5>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="row">
                                <h5 class="my-option-name time">Arrival Time:</h5>
                                <h5 class="time"
                                    th:text="${#temporals.format(#temporals.createDateTime(flight.arrivalTime,'yyyy-MM-dd''T''HH:mm'),'dd-MM-yyyy HH:mm')}"></h5>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="row">
                                <p class="my-option-name price">Economy Price: </p>
                                <p class="price" th:text="${flight.ecnonomyPrice}+'$'"></p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="row">
                                <p class="my-option-name price">Business Price: </p>
                                <p class="price" th:text="${flight.businessPrice}+'$'"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div th:with="ticketList=${ticketListEntry.getValue()}">
                <div th:each="ticket : ${ticketList}">
                    <div class="ticket-box">
                        <div class="ticket">
                            <div th:if="${ticket.getPromotionTicketList()!=null}">
                                <div th:with="promotionTicketList=${ticket.getPromotionTicketList()}">
                                    <div th:text="'There are: '+${promotionTicketList.size()}+' promotion ticket was used for this ticket'"></div>
                                </div>
                                <div th:text="'Price Reduction: ' + ${#numbers.formatDecimal(ticketService.priceReductionForTicket(ticket) * 100, 1, 2, 'COMMA')} + '%'"></div>
                                <div th:text="'Ticket Original Price: '+ ${#numbers.formatDecimal(ticket.price, 1, 2, 'COMMA')} +'$'"></div>
                                <div th:text="'Ticket Price After Reduction: '+ ${#numbers.formatDecimal(ticketService.ticketCost(ticket), 1, 2, 'COMMA')} + '$'"></div>
                            </div>
                            <form th:action="@{/user/passenger-register}" method="post">
                                <input type="number" readonly th:value="${ticket.id}" hidden="hidden" name="ticketId">
                                <div th:text="'Seat: '+${ticket.seat.name}"></div>
                                <div th:with="passenger=${ticketService.findPassengerByTicketId(ticket.id)}">
                                    <input type="text" placeholder="Identity" th:value="${passenger.identity}"
                                           name="identity"
                                           required>
                                    <input type="text" placeholder="Name" th:value="${passenger.name}" name="name"
                                           required>
                                    <input type="text" placeholder="Address" th:value="${passenger.address}"
                                           name="address">
                                    <input type="date" th:value="${passenger.dob}" name="dob">
                                    <select name="gender">
                                        <option value="" selected>Choose Your Gender</option>
                                        <th:block th:each="gender : ${genderList}">
                                            <option th:value="${gender}" th:text="${gender}"
                                                    th:selected="${gender == passenger.gender}"></option>
                                        </th:block>
                                    </select>
                                </div>
                                <button type="submit">Apply Passenger</button>
                            </form>
                            <button><a th:href="@{/user/refund-ticket/{ticketId}(ticketId=${ticket.id})}">Refund</a>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
</body>
</html>